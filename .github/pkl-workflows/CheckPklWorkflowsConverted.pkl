amends "@gha/Workflow.pkl"
import "@gha/actions/Common.pkl"
import "modules/Steps.pkl"

name = "CheckPklWorkflowsConverted"

on {
  push {}
}

jobs {
  ["checkWorkflowsConverted"] {
    `runs-on` = new UbuntuLatest {}
    steps {
      ...Steps.checkoutAndInstallPkl
      new {
        name = "Convert pkl workflows to yaml"
        `working-directory` = ".github/pkl-workflows"
        run =
          """
          pkl project resolve
          pkl eval *.pkl -o ../workflows/%{moduleName}.generated.yml
          """
      }
      new {
        name = "Verify if pkl actions are converted"
        run = "git diff --exit-code"
      }
    }
  }
}
