amends "package://pkg.pkl-lang.org/github.com/stefma/pkl-gha/com.github.action@0.0.2#/GitHubAction.pkl"
import "modules/Steps.pkl"

name = "CheckPklActionsConverted"

on {
  push {}
}

jobs {
  ["checkActionsConverted"] {
    `runs-on` = new UbuntuLatest {}
    steps {
      ...Steps.checkoutAndInstallPkl()
      new {
        name = "Convert pkl actions to yaml"
        run = """
          for file in .github/workflows/*.pkl; do
            pkl eval "$file" -o "${file/.pkl/.yaml}"
          done
          """
      }
      new {
        name = "Verify if pkl actions are converted"
        run = "git diff --exit-code"
      }
    }
  }
}
